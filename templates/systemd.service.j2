[Unit]
Description=Kubernetes Node Agent

[Service]
ExecStart=/usr/bin/kubelet --config {{ kubelet_config }}                    \
            --kubeconfig {{ kubelet_kubeconfig }}                           \
            --hostname-override {{ ansible_fqdn }}                          \
            --container-runtime=remote                                      \
            {% if not kubelet_propagate_host_resolvconf %}--resolv-conf=""  \
            {% endif -%}
            --container-runtime-endpoint=unix://{{ kubelet_containerd_socket }}
Restart=on-failure
Type=simple
ExecStop=/bin/kill $MAINPID
ExecStop=/bin/kill $MAINPID

[Install]
WantedBy=multi-user.target
